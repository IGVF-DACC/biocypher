<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Host-BioCypher Adapter &mdash; BioCypher  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Usage Notes" href="usage.html" />
    <link rel="prev" title="Section 1: Basics - Adding data" href="tutorial_1.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="contents.html" class="icon icon-home"> BioCypher
          </a>
              <div class="version">
                0.3.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_intro.html">BioCypher Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_1.html">Section 1: Basics - Adding data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The Host-BioCypher Adapter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#loading-the-data">Loading the Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#passing-the-data">Passing the Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#communication-via-the-neo4j-python-driver">Communication via the Neo4j Python Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interacting-with-a-running-neo4j-instance">Interacting with a running Neo4j instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exporting-for-the-neo4j-admin-import-feature">Exporting for the <code class="docutils literal notranslate"><span class="pre">neo4j-admin</span> <span class="pre">import</span></code> feature</a></li>
<li class="toctree-l2"><a class="reference internal" href="#translating-between-original-and-biocypher-vocabulary">Translating between original and BioCypher vocabulary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="submodule.html">Submodule documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="contents.html">BioCypher</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="contents.html" class="icon icon-home"></a> &raquo;</li>
      <li>The Host-BioCypher Adapter</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/adapter.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="the-host-biocypher-adapter">
<span id="adapter-functions"></span><h1>The Host-BioCypher Adapter<a class="headerlink" href="#the-host-biocypher-adapter" title="Permalink to this heading"></a></h1>
<p>The “BioCypher adapter” is a python program (in the case of <code class="docutils literal notranslate"><span class="pre">PyPath</span></code>,
a submodule) responsible for piping the data that is to be represented
in the graph into BioCypher in a somewhat arbitrary format. It is an
expansion tailor-made for the source database as an interface to
BioCypher; in developing BioCypher, we strive to make its structure as
simple as possible to facilitate adaptation. Thus, the adapter usually
consists of only few central functions needed for the transfer of data
between the arbitrarily ordered source format and the highly
“automatically compatible” target format of BioCypher. In our example,
the adapter performs three main functions (with functions 2 and 3 being
mutually optional):</p>
<ol class="arabic simple">
<li><p>Load the <code class="docutils literal notranslate"><span class="pre">PyPath</span></code> data python object to be transferred to BioCypher</p></li>
<li><p>Pass the data to BioCypher as a stream or list to be written to the
Neo4j database via the python driver (“online”)</p></li>
<li><p>Pass the data to BioCypher as a stream or list to be written to the
Neo4j database via admin import (batch import from CSV)</p></li>
</ol>
<p>While function #2 can be performed at any time with a new or
pre-existing BioCypher graph, function #3 can only be used to create a
fresh database from scratch with all the input data. However, since
<code class="docutils literal notranslate"><span class="pre">neo4j-admin</span> <span class="pre">import</span></code> is very fast, it can be used to combine subsets
of two databases on the fly, creating a new, combined database in the
process.</p>
<p>To facilitate transition to the new schema, we also supply functions to
translate and reverse translate terms and queries between original and
BioCypher vocabulary. The mappings are stored in the adapter upon
creation and can be retrieved through the <a class="reference internal" href="#translation"><span class="std std-ref">driver translation
functions</span></a>.</p>
<section id="loading-the-data">
<h2>Loading the Data<a class="headerlink" href="#loading-the-data" title="Permalink to this heading"></a></h2>
<p>Depending on the data source, it is up to the user to find and define a
suitable representation to be piped into BioCypher. The way we handle it
in <code class="docutils literal notranslate"><span class="pre">PyPath</span></code> is only one of many: we load the entire <code class="docutils literal notranslate"><span class="pre">PyPath</span></code> object
into memory, to be passed to BioCypher using a generator that evaluates
each <code class="docutils literal notranslate"><span class="pre">PyPath</span></code> object and transforms it to the tuple representation
described below. This is made possible by the already standardised form
in which the data is represented within <code class="docutils literal notranslate"><span class="pre">PyPath</span></code>. For more
heterogeneous data representations, additional transformations may be
necessary before piping into BioCypher.</p>
</section>
<section id="passing-the-data">
<h2>Passing the Data<a class="headerlink" href="#passing-the-data" title="Permalink to this heading"></a></h2>
<p>In the <a class="reference external" href="https://github.com/saezlab/pypath/blob/fc4c959c168ce80427189f8dd237308707594ad0/src/pypath/biocypher/adapter.py#L189">pypath
example</a>,
we are using <code class="xref py py-class docutils literal notranslate"><span class="pre">Generator</span></code>-type objects to pass an unordered
collection of <code class="docutils literal notranslate"><span class="pre">PyPath</span></code> contents into BioCypher. For nodes, we are
specifying for each object an ID and label (corresponding to its unique
preferred identifier and its ontological class), as well as a dictionary
of arbitrary properties, each entry as a 3-tuple. For relationships, the
same applies, except that we are passing two IDs, for source and target
entities, which results in a 4-tuple.</p>
<p>Currently, there are two modes of interaction with the graph database
implemented in BioCypher. The first takes place via the Neo4j python
driver, which is either loaded by BioCypher or passed from the host
module. The second generates CSV files containing node and edge data in
a standardised and safety-checked format to be used with the <code class="docutils literal notranslate"><span class="pre">admin</span> <span class="pre">import</span></code> functionality of Neo4j. Safety checks are important here
because Neo4j does not guarantee consistency of the resulting graph when
using this feature; on the upside, this mode of communication is much
faster. However, it can only be used when creating a new graph, not for
changing an already existing one.</p>
</section>
<section id="communication-via-the-neo4j-python-driver">
<h2>Communication via the Neo4j Python Driver<a class="headerlink" href="#communication-via-the-neo4j-python-driver" title="Permalink to this heading"></a></h2>
<p>The BioCypher <a class="reference internal" href="submodule.html#driver"><span class="std std-ref">Driver</span></a> is the main submodule of BioCypher. It
establishes a connection with a running graph database via the
<code class="xref py py-class docutils literal notranslate"><span class="pre">neo4j.GraphDatabase.driver</span></code>, integrates the funtions of the
other submodules, and serves as outside interface of BioCypher. The
<code class="docutils literal notranslate"><span class="pre">Driver</span></code> is the main class for interacting with BioCypher in the host
module’s adapter class. It handles authentification and basic database
management as well as the creation and manipulation of graph entries. It
can be instantiated and accessed like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">biocypher</span>

<span class="c1"># offline mode</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">biocypher</span><span class="o">.</span><span class="n">Driver</span><span class="p">(</span>
   <span class="n">db_name</span> <span class="o">=</span> <span class="s2">&quot;neo4j&quot;</span><span class="p">,</span> 
   <span class="n">offline</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># online mode</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">biocypher</span><span class="o">.</span><span class="n">Driver</span><span class="p">(</span>
   <span class="n">db_name</span> <span class="o">=</span> <span class="s2">&quot;neo4j&quot;</span><span class="p">,</span> 
   <span class="n">db_user</span> <span class="o">=</span> <span class="s2">&quot;neo4j&quot;</span><span class="p">,</span> 
   <span class="n">db_passwd</span> <span class="o">=</span> <span class="s2">&quot;neo4j&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In our example, it is instantiated in the initialisation of the adapter,
and then called on for <a class="reference internal" href="#running"><span class="std std-ref">interacting with a running graph</span></a> and
for exporting a complete database in CSV format for the <a class="reference internal" href="#admin-import"><span class="std std-ref">Neo4j
admin-import feature</span></a>. Upon instantiation, it
automatically assesses the graph database it is connected to (specified
using the <code class="docutils literal notranslate"><span class="pre">db_name</span></code> argument) regarding whether or not it already
contains a BioCypher graph, and, if so, what the structure of this graph
is.</p>
<p>If there exists no BioCypher graph in the currently active database, or
if the user explicitly specifies so using the <code class="docutils literal notranslate"><span class="pre">wipe</span></code> attribute of the
driver, a new BioCypher database is created using the schema
configuration specified in the <a class="reference internal" href="quickstart.html#schema-config"><span class="std std-ref">schema-config.yaml</span></a>.</p>
</section>
<section id="interacting-with-a-running-neo4j-instance">
<span id="running"></span><h2>Interacting with a running Neo4j instance<a class="headerlink" href="#interacting-with-a-running-neo4j-instance" title="Permalink to this heading"></a></h2>
<p>Once instantiated, the BioCypher driver can be used to modify the
current graph by adding or deleting nodes, edges, properties,
constraints, et cetera. Most commonly, the methods
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.Driver.add_nodes()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.Driver.add_edges()</span></code> are used to introduce new
entries into the graph database.</p>
</section>
<section id="exporting-for-the-neo4j-admin-import-feature">
<span id="admin-import"></span><h2>Exporting for the <code class="docutils literal notranslate"><span class="pre">neo4j-admin</span> <span class="pre">import</span></code> feature<a class="headerlink" href="#exporting-for-the-neo4j-admin-import-feature" title="Permalink to this heading"></a></h2>
<p>Particularly if the data are very extensive (or performance is of the
utmost priority), BioCypher can be used to facilitate a speedy and safe
import of the data using the <code class="docutils literal notranslate"><span class="pre">neo4j-admin</span> <span class="pre">import</span></code> console command.
<a class="reference external" href="https://neo4j.com/docs/operations-manual/current/tutorial/neo4j-admin-import/">Admin
Import</a>
is a particularly fast method of writing data to a newly created graph
database (the database needs to be completely empty) that gains most of
its performance advantage from turning off safety features regarding
input data consistency. Therefore, a sound and consistent representation
of the nodes and edges in the graph is of high importance in this
process, which is why the BioCypher export functionality has been
specifically designed to perform type and content checking for all data
to be written to the graph.</p>
<p>Data input from the source database is exactly as in the case of
<a class="reference internal" href="#running"><span class="std std-ref">interacting with a running database</span></a>, with the data
representation being converted to a series of CSV files in a designated
output folder (standard being <code class="docutils literal notranslate"><span class="pre">biocypher-out/</span></code> and the current datetime).
BioCypher creates separate header and data files for all node and edge
types to be represented in the graph via the driver methods
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.Driver.write_nodes()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.Driver.write_edges()</span></code>. Additionally, it creates
a file called <code class="docutils literal notranslate"><span class="pre">neo4j-admin-import-call.txt</span></code> containing the console
command for creating a new database, which only has to be executed from
the directory of the currently running Neo4j database.</p>
<p>The name of the database to be created is given by the <code class="docutils literal notranslate"><span class="pre">db_name</span></code>
attribute of the driver methods, ie, <code class="docutils literal notranslate"><span class="pre">write_nodes()</span></code> and
<code class="docutils literal notranslate"><span class="pre">write_edges()</span></code>, which should receive the same name as in the
<code class="docutils literal notranslate"><span class="pre">PyPath</span></code> adapter example, and can be arbitrary. In case the
<code class="docutils literal notranslate"><span class="pre">db_name</span></code> is not the default Neo4j database name, <code class="docutils literal notranslate"><span class="pre">neo4j</span></code>, the
database needs to be created in Neo4j before or after using the
<code class="docutils literal notranslate"><span class="pre">neo4j-admin</span> <span class="pre">import</span></code> statement. This can be done by executing, in the
running database (<code class="docutils literal notranslate"><span class="pre">&lt;db_name&gt;</span></code> being the name assigned in the method):</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">:use</span> <span class="pre">system</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">create</span> <span class="pre">database</span> <span class="pre">&lt;db_name&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:use</span> <span class="pre">&lt;db_name&gt;</span></code></p></li>
</ol>
</section>
<section id="translating-between-original-and-biocypher-vocabulary">
<span id="translation"></span><h2>Translating between original and BioCypher vocabulary<a class="headerlink" href="#translating-between-original-and-biocypher-vocabulary" title="Permalink to this heading"></a></h2>
<p>For quickly transitioning to BioCypher, single terms or entire queries
can be translated using the information provided in the
<code class="docutils literal notranslate"><span class="pre">schema_config.yaml</span></code>. The translation functionality can be accessed
through the driver methods <code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.translate_term()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.reverse_translate_term()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.translate_query()</span></code>, and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.reverse_translate_query()</span></code>. For instance, to
find out the designation of “gene_gene” relationships in BioCypher, one
can call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">driver</span><span class="o">.</span><span class="n">translate_term</span><span class="p">(</span><span class="s2">&quot;gene_gene&quot;</span><span class="p">)</span>
<span class="c1"># &#39;GeneToGeneAssociation&#39;</span>
</pre></div>
</div>
<p>Similarly, to discover the original naming of
“PostTranslationalInteraction” relationships, one can call the reverse
function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">driver</span><span class="o">.</span><span class="n">reverse_translate_term</span><span class="p">(</span><span class="s2">&quot;PostTranslationalInteraction&quot;</span><span class="p">)</span>
<span class="c1"># &#39;post_translational&#39;</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.translate_query()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">biocypher.driver.reverse_translate_query()</span></code> replace all label
designations (following a “:”) in entire CYPHER query strings with the
BioCypher or original versions, respectively.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tutorial_1.html" class="btn btn-neutral float-left" title="Section 1: Basics - Adding data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="usage.html" class="btn btn-neutral float-right" title="Usage Notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2022, BioCypher developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>